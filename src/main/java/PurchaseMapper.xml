<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="resource.PurchaseMapper">

	<!-- getStockValue-->
	<select id="getStockValue" parameterType="int" resultType="int">
		<!-- WITH P AS (SELECT COMPANY_ID, SUM(PRICE*QUANTITY)AS "ESTI_VALUE" FROM PURCHASE_LIST WHERE ACCOUNT_ID = #{u_id} GROUP BY COMPANY_ID) SELECT SUM(P.ESTI_VALUE) AS "STOCK_VALUE" FROM P -->
		WITH T AS (SELECT P.COMPANY_ID, SUM(CURJUKA*QUANTITY)AS "ESTI_VALUE" FROM PURCHASE_LIST P, COMPANYS C WHERE P.COMPANY_ID = C.COMPANY_ID AND ACCOUNT_ID = #{account_id} GROUP BY P.COMPANY_ID) SELECT SUM(T.ESTI_VALUE) AS "SUM_STOCK_VALUE" FROM T
	</select>
	
	<!-- getMyStock -->
	<select id="getMyStock" parameterType="int" resultType="vo.MyStockVO">
		WITH P AS (SELECT COMPANY_ID, SUM(PRICE*QUANTITY) AS "SUM_PRICE", SUM(QUANTITY) AS "QUANTITY" FROM PURCHASE_LIST WHERE ACCOUNT_ID = #{account_id} GROUP BY COMPANY_ID) SELECT P.COMPANY_ID, NAME, P.SUM_PRICE/P.QUANTITY AS "PRICE", CURJUKA, P.QUANTITY FROM P, COMPANYS C WHERE p.COMPANY_ID = C.COMPANY_ID
	</select>
	
	<!-- getOneComapnyStock -->
	<select id="getOneCompanyStock" parameterType="java.util.HashMap" resultType="vo.PurchaseVO">
		SELECT *  FROM PURCHASE_LIST WHERE ACCOUNT_ID = #{account_id} AND COMPANY_ID = #{company_id}
	</select>
	
	<!-- getQuantity -->
	<select id="getQuantity" parameterType="int" resultType="int">
		SELECT QUANTITY FROM PURCHASE_LIST WHERE LIST_ID = #{list_id}
	</select>
	
	<!-- sellStockUpdate -->
	<update id="sellStockUpdate" parameterType="vo.PurchaseVO">
		UPDATE PURCHASE_LIST SET QUANTITY = QUANTITY - #{quantity} WHERE LIST_ID = #{list_id}
	</update>
	
	<!-- sellStockDelete -->
	<delete id="sellStockDelete" parameterType="vo.PurchaseVO">
		DELETE FROM PURCHASE_LIST WHERE LIST_ID = #{list_id}
	</delete>
	
</mapper>